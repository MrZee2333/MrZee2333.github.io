<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能运动健康平台</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(135deg, #e0f2fe 0%, #fff7ed 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            font-size: 2rem;
            color: #1f2937;
            margin-bottom: 2rem;
        }
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 2rem;
        }
        .card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        .card-blue {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
        }
        .card-orange {
            background: linear-gradient(135deg, #f97316, #ea580c);
            color: white;
        }
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        .card-title {
            font-size: 1.5rem;
            font-weight: 600;
        }
        .exercise-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin: 1rem 0;
        }
        .exercise-btn {
            background: white;
            border: none;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .exercise-btn:hover {
            background: #f3f4f6;
        }
        .exercise-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        .form-group {
            margin-bottom: 1rem;
        }
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #4b5563;
        }
        .form-control {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 1rem;
        }
        .drink-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        .drink-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            border: 1px solid #e5e7eb;
        }
        .drink-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        .drink-info {
            color: #6b7280;
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }
        .exercise-detail {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }
        .exercise-detail.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .detail-content {
            background: white;
            border-radius: 12px;
            padding: 20px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }
        .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .result-card {
            background: #f3f4f6;
            border-radius: 8px;
            padding: 15px;
            margin-top: 1rem;
        }
        .result-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            object-fit: cover;
        }
        .login-btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
        }
        .login-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }
        .login-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .login-content {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
        }
        .avatar-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin: 1rem 0;
        }
        .avatar-option {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: border-color 0.2s;
        }
        .avatar-option.selected {
            border-color: #3b82f6;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>智能运动健康平台</h1>
            <div class="user-info">
                <img id="userAvatar" src="https://api.dicebear.com/7.x/avataaars/svg?seed=default" alt="用户头像" class="avatar" onclick="showLoginModal()">
                <span id="userName">未登录</span>
                <button class="login-btn" onclick="showLoginModal()">登录</button>
            </div>
        </div>

        <!-- 登录弹窗 -->
        <div id="loginModal" class="login-modal">
            <div class="login-content">
                <h2 class="card-title mb-4" id="loginTitle">用户登录</h2>
                <div class="form-group">
                    <label>用户名</label>
                    <input type="text" id="loginUsername" class="form-control" placeholder="请输入用户名">
                </div>
                <div class="form-group">
                    <label>密码</label>
                    <input type="password" id="loginPassword" class="form-control" placeholder="请输入密码">
                </div>
                <div class="form-group" id="avatarSelectGroup" style="display:none;">
                    <label>选择头像</label>
                    <div class="avatar-grid" id="avatarGrid">
                        <!-- 头像选项将通过JavaScript动态生成 -->
                    </div>
                </div>
                <div class="form-group" id="registerWeightGroup" style="display:none;">
                    <label>体重 (kg)</label>
                    <input type="number" id="registerWeight" class="form-control" placeholder="请输入体重" min="0" step="0.1">
                </div>
                <div class="form-group" id="registerAgeGroup" style="display:none;">
                    <label>年龄</label>
                    <input type="number" id="registerAge" class="form-control" placeholder="请输入年龄" min="0" max="120">
                </div>
                <button onclick="submitLoginOrRegister()" class="form-control" style="background: #3b82f6; color: white; border: none; cursor: pointer; margin-top: 1rem;" id="loginSubmitBtn">
                    登录
                </button>
                <div style="text-align:center; margin-top:1rem;">
                    <span id="toggleLoginRegister" style="color:#3b82f6; cursor:pointer;">没有账号？注册</span>
                </div>
            </div>
        </div>

        <!-- 主要功能卡片 -->
        <div class="card-grid">
            <div class="card card-blue">
                <div class="card-header">
                    <h2 class="card-title">运动记录</h2>
                </div>
                <p>记录您的运动数据，追踪健康指标</p>
                <div style="margin-top: 1rem; display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 0.875rem;">今日运动时间：</span>
                    <input type="number" id="todayExerciseTime" value="32" style="width: 60px; padding: 4px; border: 1px solid #d1d5db; border-radius: 4px;">
                    <span style="font-size: 0.875rem;">分钟</span>
                </div>
                <button onclick="showExerciseHistory()" class="form-control" style="background: #3b82f6; color: white; border: none; cursor: pointer; margin-top: 1rem;">
                    查看运动记录
                </button>
            </div>

            <div class="card card-orange">
                <div class="card-header">
                    <h2 class="card-title">补水建议</h2>
                </div>
                <p>智能推荐电解质补充方案</p>
                <div style="margin-top: 1rem; font-size: 0.875rem;">
                    <div id="nextHydrationTime">距离下次补充还有：15分钟</div>
                    <div id="todayHydration" style="margin-top: 0.5rem;"></div>
                </div>
            </div>
        </div>

        <!-- 运动类型选择 -->
        <div class="card">
            <h2 class="card-title">选择运动类型</h2>
            <div class="exercise-grid">
                <button class="exercise-btn" id="btn-swimming" onclick="showExerciseDetail('swimming')">
                    <div class="exercise-icon">🏊‍♂️</div>
                    <div>游泳</div>
                </button>
                <button class="exercise-btn" id="btn-cycling" onclick="showExerciseDetail('cycling')">
                    <div class="exercise-icon">🚴‍♂️</div>
                    <div>骑行</div>
                </button>
                <button class="exercise-btn" id="btn-running" onclick="showExerciseDetail('running')">
                    <div class="exercise-icon">🏃‍♂️</div>
                    <div>跑步</div>
                </button>
                <button class="exercise-btn" id="btn-basketball" onclick="showExerciseDetail('basketball')">
                    <div class="exercise-icon">🏀</div>
                    <div>篮球</div>
                </button>
                <button class="exercise-btn" id="btn-football" onclick="showExerciseDetail('football')">
                    <div class="exercise-icon">⚽</div>
                    <div>足球</div>
                </button>
                <button class="exercise-btn" id="btn-badminton" onclick="showExerciseDetail('badminton')">
                    <div class="exercise-icon">🏸</div>
                    <div>羽毛球</div>
                </button>
                <button class="exercise-btn" id="btn-tennis" onclick="showExerciseDetail('tennis')">
                    <div class="exercise-icon">🎾</div>
                    <div>网球</div>
                </button>
            </div>
        </div>

        <!-- 运动详情弹窗 -->
        <div id="exerciseDetail" class="exercise-detail">
            <div class="detail-content">
                <button class="close-btn" onclick="hideExerciseDetail()">×</button>
                <h2 id="exerciseTitle" class="card-title mb-4"></h2>
                
                <div class="form-group">
                    <label>运动时长 (分钟)</label>
                    <input type="number" id="duration" class="form-control" placeholder="请输入运动时长" min="0">
                </div>
                <div class="form-group">
                    <label>环境温度 (℃)</label>
                    <input type="number" id="temperature" class="form-control" placeholder="请输入环境温度" min="-20" max="50">
                </div>
                <div class="form-group">
                    <label>消耗卡路里 (kcal)</label>
                    <input type="number" id="calories" class="form-control" placeholder="请输入消耗卡路里" min="0">
                </div>
                
                <button onclick="calculateElectrolytes()" class="form-control" style="background: #3b82f6; color: white; border: none; cursor: pointer; margin-bottom: 1rem;">
                    计算电解质补充
                </button>

                <div id="resultCard" class="result-card" style="display: none;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3 class="card-title mb-2">电解质补充建议</h3>
                        <button onclick="recalculateElectrolytes()" class="form-control" style="background: #10b981; color: white; border: none; cursor: pointer; width: auto; padding: 0.5rem 1rem;">
                            重新计算
                        </button>
                    </div>
                    <div class="result-item">
                        <span>出汗量：</span>
                        <span id="sweatVolume">0 L</span>
                    </div>
                    <div class="result-item">
                        <span>钠 (Na+)：</span>
                        <span id="sodium">0 mg</span>
                    </div>
                    <div class="result-item">
                        <span>钾 (K+)：</span>
                        <span id="potassium">0 mg</span>
                    </div>
                    <div class="result-item">
                        <span>镁 (Mg²⁺)：</span>
                        <span id="magnesium">0 mg</span>
                    </div>
                    <div class="result-item">
                        <span>氯 (Cl⁻)：</span>
                        <span id="chloride">0 mg</span>
                    </div>
                    
                    <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #e5e7eb;">
                        <h4 style="margin-bottom: 0.5rem;">饮料补充建议</h4>
                        <div id="drinkRecommendation"></div>
                        <div style="margin-top: 0.5rem; font-size: 0.875rem; color: #ef4444;">
                            ⚠️ 注意：不建议仅通过饮料补充全部电解质，建议：
                            <ul style="margin-top: 0.5rem; padding-left: 1rem;">
                                <li>1-2瓶运动饮料 + 电解质片</li>
                                <li>自制电解质水（柠檬水+盐+少许蜂蜜）</li>
                                <li>无糖电解质补充剂</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 补水建议 -->
        <div class="card" style="margin-top: 20px;">
            <h2 class="card-title">推荐饮料</h2>
            <div class="drink-grid">
                <div class="drink-card">
                    <img src="/Users/dumingkun/Desktop/365f94b65caefd9ffc676f4d306c277e.jpeg" alt="脉动" style="width: 100px; height: 100px; object-fit: contain;">
                    <h3>脉动</h3>
                    <div class="drink-info">
                        <p>钠含量：18mg</p>
                        <p>钾含量：12mg</p>
                        <p>糖分：高</p>
                        <p>推荐量：300ml</p>
                    </div>
                </div>
                <div class="drink-card">
                    <img src="/Users/dumingkun/Desktop/18821d8f0e01911c6011763978ca16c4.jpg" alt="宝矿力水特" style="width: 100px; height: 100px; object-fit: contain;">
                    <h3>宝矿力水特</h3>
                    <div class="drink-info">
                        <p>钠含量：49mg</p>
                        <p>钾含量：20mg</p>
                        <p>糖分：中</p>
                        <p>推荐量：300ml</p>
                    </div>
                </div>
                <div class="drink-card">
                    <img src="/Users/dumingkun/Desktop/af05ca5e3c22b9c77b02ab7c10b81753.jpeg" alt="尖叫" style="width: 100px; height: 100px; object-fit: contain;">
                    <h3>尖叫</h3>
                    <div class="drink-info">
                        <p>钠含量：50mg</p>
                        <p>钾含量：30mg</p>
                        <p>糖分：中</p>
                        <p>推荐量：300ml</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 运动记录弹窗 -->
        <div id="exerciseHistory" class="exercise-detail">
            <div class="detail-content">
                <button class="close-btn" onclick="hideExerciseHistory()">×</button>
                <h2 class="card-title mb-4">运动记录</h2>
                <div id="historyList" style="max-height: 60vh; overflow-y: auto;">
                    <!-- 运动记录将在这里动态显示 -->
                </div>
            </div>
        </div>

        <!-- 新增：热身与拉伸动作弹窗 -->
        <div id="warmupModal" class="exercise-detail">
            <div class="detail-content">
                <button class="close-btn" onclick="hideWarmupModal()">×</button>
                <h2 class="card-title mb-4" id="warmupTitle">热身与拉伸动作</h2>
                <div id="warmupContent"></div>
            </div>
        </div>

        <!-- 新增：健康健身食谱推荐卡片 -->
        <div class="card" style="margin-top: 20px;">
            <h2 class="card-title">健康健身食谱推荐</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 20px;">
                <!-- 运动前餐 -->
                <div style="background: #f0fdf4; border-radius: 10px; padding: 16px;">
                    <h3 style="margin-bottom: 0.5rem;">⚡ 运动前餐（建议在运动前1-2小时吃）</h3>
                    <div style="display:flex;align-items:center;gap:10px;">
                        <img src="https://images.pexels.com/photos/1640777/pexels-photo-1640777.jpeg?auto=compress&w=200&h=200&fit=crop" alt="全麦燕麦碗" style="width:80px;height:80px;border-radius:8px;object-fit:cover;">
                        <div>
                            <b>🥣 全麦燕麦碗</b><br>
                            <span style="font-size:0.95em;">五黑麦片/燕麦片+香蕉+花生酱+蜂蜜+牛奶/豆奶</span>
                        </div>
                    </div>
                    <div style="color:#16a34a;font-size:0.95em;margin:0.5em 0;">慢消化碳水+优质脂肪+低GI，稳定血糖，避免低血糖</div>
                    <div style="color:#64748b;font-size:0.93em;">做法：麦片加热牛奶煮3分钟，加入其他配料即可</div>
                    <hr style="margin:1em 0;">
                    <div style="display:flex;align-items:center;gap:10px;">
                        <img src="https://images.pexels.com/photos/461382/pexels-photo-461382.jpeg?auto=compress&w=200&h=200&fit=crop" alt="鸡蛋全麦三明治" style="width:80px;height:80px;border-radius:8px;object-fit:cover;">
                        <div>
                            <b>🍞 鸡蛋全麦三明治</b><br>
                            <span style="font-size:0.95em;">全麦面包+水煮蛋+生菜/番茄+酸奶</span>
                        </div>
                    </div>
                    <div style="color:#16a34a;font-size:0.95em;margin:0.5em 0;">丰富蛋白+适量碳水+蔬菜纤维，不油腻</div>
                </div>
                <!-- 运动后恢复餐 -->
                <div style="background: #f0f9ff; border-radius: 10px; padding: 16px;">
                    <h3 style="margin-bottom: 0.5rem;">💪 运动后恢复餐（建议运动后30分钟内进食）</h3>
                    <div style="display:flex;align-items:center;gap:10px;">
                        <img src="https://images.pexels.com/photos/593837/pexels-photo-593837.jpeg?auto=compress&w=200&h=200&fit=crop" alt="鸡胸肉糙米饭蔬菜拼盘" style="width:80px;height:80px;border-radius:8px;object-fit:cover;">
                        <div>
                            <b>🍚 鸡胸肉+糙米饭+蔬菜拼盘</b><br>
                            <span style="font-size:0.95em;">鸡胸肉+糙米/小米饭+西兰花/胡萝卜/玉米</span>
                        </div>
                    </div>
                    <div style="color:#0ea5e9;font-size:0.95em;margin:0.5em 0;">高蛋白修复肌肉，复合碳水补充能量，蔬菜帮助消化抗炎</div>
                    <hr style="margin:1em 0;">
                    <div style="display:flex;align-items:center;gap:10px;">
                        <img src="https://images.pexels.com/photos/1640772/pexels-photo-1640772.jpeg?auto=compress&w=200&h=200&fit=crop" alt="蛋白奶昔水果" style="width:80px;height:80px;border-radius:8px;object-fit:cover;">
                        <div>
                            <b>🥤 蛋白奶昔+水果</b><br>
                            <span style="font-size:0.95em;">乳清蛋白+香蕉/蓝莓+牛奶/豆奶+坚果</span>
                        </div>
                    </div>
                    <div style="color:#0ea5e9;font-size:0.95em;margin:0.5em 0;">快速吸收蛋白+抗氧化物+微量脂肪，助力肌肉修复和恢复</div>
                </div>
                <!-- 日常控制体重 & 增强代谢餐 -->
                <div style="background: #fef9c3; border-radius: 10px; padding: 16px;">
                    <h3 style="margin-bottom: 0.5rem;">🔥 日常控制体重 & 增强代谢餐</h3>
                    <div style="display:flex;align-items:center;gap:10px;">
                        <img src="https://images.pexels.com/photos/1640770/pexels-photo-1640770.jpeg?auto=compress&w=200&h=200&fit=crop" alt="金枪鱼沙拉饭" style="width:80px;height:80px;border-radius:8px;object-fit:cover;">
                        <div>
                            <b>🥗 金枪鱼沙拉饭</b><br>
                            <span style="font-size:0.95em;">金枪鱼罐头+蔬菜+小米饭/藜麦+酸奶/橄榄油</span>
                        </div>
                    </div>
                    <div style="color:#eab308;font-size:0.95em;margin:0.5em 0;">饱腹感强、脂肪低，富含DHA，有助于心血管健康</div>
                    <div style="color:#64748b;font-size:0.93em;">热量：约450-550 kcal</div>
                    <hr style="margin:1em 0;">
                    <div style="display:flex;align-items:center;gap:10px;">
                        <img src="/Users/dumingkun/Desktop/寻找西红柿鸡蛋炒豆腐图片.png" style="width:80px;height:80px;border-radius:8px;object-fit:cover;" alt="西红柿鸡蛋炒豆腐">
                        <div>
                            <b>🍳 西红柿鸡蛋炒豆腐</b><br>
                            <span style="font-size:0.95em;">鸡蛋+嫩豆腐+西红柿+橄榄油</span>
                        </div>
                    </div>
                    <div style="color:#eab308;font-size:0.95em;margin:0.5em 0;">植物蛋白+动物蛋白结合，消化好且对肠胃友好</div>
                    <div style="color:#64748b;font-size:0.93em;">搭配：五谷粥或小米饭</div>
                    <hr style="margin:1em 0;">
                    <div style="display:flex;align-items:center;gap:10px;">
                        <img src="/Users/dumingkun/Desktop/杂粮粥图片 copy.png" style="width:80px;height:80px;border-radius:8px;object-fit:cover;" alt="减脂杂粮粥早餐">
                        <div>
                            <b>🥣 减脂杂粮粥早餐</b><br>
                            <span style="font-size:0.95em;">五黑麦片+红枣+黑豆/薏米+牛奶/水煮</span>
                        </div>
                    </div>
                    <div style="color:#eab308;font-size:0.95em;margin:0.5em 0;">高纤维、低脂肪，适合减脂和日常健康早餐</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 页面加载时自动清空所有本地注册用户数据
        localStorage.removeItem('userData');

        const exerciseTypes = {
            swimming: { name: '游泳', factor: 0.6 },
            cycling: { name: '骑行', factor: 0.9 },
            running: { name: '跑步', factor: 1.0 },
            basketball: { name: '篮球', factor: 1.2 },
            football: { name: '足球', factor: 1.3 },
            badminton: { name: '羽毛球', factor: 1.0 },
            tennis: { name: '网球', factor: 1.0 }
        };

        // 保存运动记录
        let exerciseHistory = [];

        // 用户数据管理
        let currentUser = null;
        let userData = JSON.parse(localStorage.getItem('userData')) || {};

        // 生成头像选项
        function generateAvatarOptions() {
            const avatarGrid = document.getElementById('avatarGrid');
            const seeds = ['default', 'john', 'jane', 'mike', 'sarah', 'david', 'lisa', 'tom'];
            
            seeds.forEach(seed => {
                const img = document.createElement('img');
                img.src = `https://api.dicebear.com/7.x/avataaars/svg?seed=${seed}`;
                img.className = 'avatar-option';
                img.onclick = () => selectAvatar(seed);
                avatarGrid.appendChild(img);
            });
        }

        function selectAvatar(seed) {
            document.querySelectorAll('.avatar-option').forEach(avatar => {
                avatar.classList.remove('selected');
            });
            event.target.classList.add('selected');
            currentUser = { ...currentUser, avatarSeed: seed };
        }

        function showLoginModal() {
            document.getElementById('loginModal').classList.add('active');
            if (!document.getElementById('avatarGrid').children.length) {
                generateAvatarOptions();
            }
        }

        function hideLoginModal() {
            document.getElementById('loginModal').classList.remove('active');
        }

        // 登录/注册切换逻辑
        let isRegister = false;
        document.getElementById('toggleLoginRegister').onclick = function() {
            isRegister = !isRegister;
            document.getElementById('loginTitle').textContent = isRegister ? '用户注册' : '用户登录';
            document.getElementById('loginSubmitBtn').textContent = isRegister ? '注册' : '登录';
            document.getElementById('avatarSelectGroup').style.display = isRegister ? 'block' : 'none';
            document.getElementById('registerWeightGroup').style.display = isRegister ? 'block' : 'none';
            document.getElementById('registerAgeGroup').style.display = isRegister ? 'block' : 'none';
            this.textContent = isRegister ? '已有账号？登录' : '没有账号？注册';
        };

        function submitLoginOrRegister() {
            if (isRegister) {
                register();
            } else {
                login();
            }
        }

        // 注册逻辑
        function register() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            const selectedAvatar = document.querySelector('.avatar-option.selected');
            const weight = parseFloat(document.getElementById('registerWeight').value);
            const age = parseInt(document.getElementById('registerAge').value);
            if (!username || !password || !selectedAvatar || !weight || !age) {
                alert('请填写完整信息并选择头像');
                return;
            }
            if (userData[username]) {
                alert('用户名已存在，请直接登录');
                return;
            }
            userData[username] = {
                password,
                avatarSeed: selectedAvatar.src.split('seed=')[1],
                exerciseHistory: [],
                lastLogin: new Date().toISOString(),
                weight,
                age
            };
            localStorage.setItem('userData', JSON.stringify(userData));
            alert('注册成功，请登录！');
            isRegister = false;
            document.getElementById('loginTitle').textContent = '用户登录';
            document.getElementById('loginSubmitBtn').textContent = '登录';
            document.getElementById('avatarSelectGroup').style.display = 'none';
            document.getElementById('registerWeightGroup').style.display = 'none';
            document.getElementById('registerAgeGroup').style.display = 'none';
            document.getElementById('toggleLoginRegister').textContent = '没有账号？注册';
        }

        // 登录逻辑（头像选择不再强制）
        function login() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            if (!username || !password) {
                alert('请填写完整信息');
                return;
            }
            if (!userData[username]) {
                alert('用户不存在，请注册');
                return;
            }
            if (userData[username].password !== password) {
                alert('密码错误');
                return;
            }
            currentUser = {
                username,
                avatarSeed: userData[username].avatarSeed
            };
            document.getElementById('userAvatar').src = `https://api.dicebear.com/7.x/avataaars/svg?seed=${currentUser.avatarSeed}`;
            document.getElementById('userName').textContent = username;
            exerciseHistory = userData[username].exerciseHistory;
            userData[username].lastLogin = new Date().toISOString();
            localStorage.setItem('userData', JSON.stringify(userData));
            hideLoginModal();
            updateTodayExerciseTime();
            updateLoginStatus();
        }

        // 拦截未登录操作
        function requireLoginAlert() {
            alert('请先登录后再使用此功能');
            showLoginModal();
        }
        // 运动类型按钮拦截
        const btnIds = ['btn-swimming','btn-cycling','btn-running','btn-basketball','btn-football','btn-badminton','btn-tennis'];
        btnIds.forEach(id => {
            const btn = document.getElementById(id);
            if (btn) {
                btn.onclick = function() {
                    if (!currentUser) {
                        requireLoginAlert();
                        return false;
                    } else {
                        showExerciseDetail(id.replace('btn-',''));
                    }
                }
            }
        });
        // 运动数据输入拦截
        document.querySelectorAll('.record-input').forEach(input => {
            input.onfocus = function() {
                if (!currentUser) {
                    requireLoginAlert();
                    this.blur();
                }
            }
        });

        // 更新今日运动时间
        function updateTodayExerciseTime() {
            if (!currentUser) {
                document.getElementById('todayExerciseTime').value = '0';
                return;
            }
            const today = new Date().toISOString().split('T')[0];
            const todayRecords = exerciseHistory.filter(record => record.date.startsWith(today));
            const totalTime = todayRecords.reduce((sum, record) => sum + (parseInt(record.duration) || 0), 0);
            document.getElementById('todayExerciseTime').value = totalTime;
            updateHydrationAdvice(totalTime);
        }

        function updateHydrationAdvice(exerciseTime) {
            const nextTime = Math.max(15 - Math.floor(exerciseTime / 30), 5);
            document.getElementById('nextHydrationTime').textContent = `距离下次补充还有：${nextTime}分钟`;
            
            // 计算今日总补水量（根据运动类型调整）
            const currentExercise = lastCalculation.exerciseType || '跑步';
            const typeFactor = Object.values(exerciseTypes).find(type => type.name === currentExercise)?.factor || 1.0;
            const baseWater = Math.ceil(exerciseTime / 30) * 300; // 每30分钟基础补水量300ml
            const totalWater = Math.round(baseWater * typeFactor);
            
            document.getElementById('todayHydration').textContent = `今日建议补水量：${totalWater}ml`;
        }

        function showExerciseDetail(type) {
            const detail = document.getElementById('exerciseDetail');
            const title = document.getElementById('exerciseTitle');
            title.textContent = exerciseTypes[type].name;
            detail.classList.add('active');
        }

        function hideExerciseDetail() {
            const detail = document.getElementById('exerciseDetail');
            detail.classList.remove('active');
        }

        function calculateDrinkRecommendation(sodium, potassium) {
            const drinks = {
                "脉动": { 
                    name: "脉动",
                    na: 360,  // 每500ml的钠含量
                    k: 60,    // 每500ml的钾含量
                    sugar: 34  // 每500ml的糖含量
                },
                "尖叫": {
                    name: "尖叫",
                    na: 480,
                    k: 80,
                    sugar: 28
                }
            };

            let recommendations = {};
            for (let drink in drinks) {
                const bottlesNa = Math.ceil(sodium / drinks[drink].na);
                const bottlesK = Math.ceil(potassium / drinks[drink].k);
                const bottles = Math.max(bottlesNa, bottlesK);
                const totalSugar = bottles * drinks[drink].sugar;
                
                recommendations[drink] = {
                    bottles: bottles,
                    totalSugar: totalSugar,
                    totalVolume: bottles * 500
                };
            }

            return recommendations;
        }

        // 保存上一次的计算结果
        let lastCalculation = {
            weight: 0,
            age: 0,
            duration: 0,
            temperature: 0,
            calories: 0,
            exerciseType: ''
        };

        function calculateElectrolytes() {
            if (!currentUser) {
                alert('请先登录后再记录运动数据');
                showLoginModal();
                return;
            }
            const weight = userData[currentUser.username].weight;
            const age = userData[currentUser.username].age;
            const duration = parseInt(document.getElementById('duration').value);
            const temperature = parseFloat(document.getElementById('temperature').value);
            const calories = parseInt(document.getElementById('calories').value);
            const exerciseType = document.getElementById('exerciseTitle').textContent;
            if (!weight || !age || !duration || !temperature || !calories) {
                alert('请填写所有信息');
                return;
            }
            lastCalculation = {
                weight,
                age,
                duration,
                temperature,
                calories,
                exerciseType
            };
            const results = calculateAndDisplayResults(weight, age, duration, temperature, calories, exerciseType);
            if (currentUser) {
                const now = new Date();
                const dateStr = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')} ${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
                const record = {
                    date: dateStr,
                    exerciseType,
                    weight,
                    age,
                    duration,
                    calories,
                    temperature,
                    sweatVolume: results.sweatVolume,
                    sodium: results.sodium,
                    potassium: results.potassium,
                    magnesium: results.magnesium,
                    chloride: results.chloride,
                    recommendedDrinks: results.recommendedDrinks,
                    drinkDetails: results.drinkDetails
                };
                exerciseHistory.unshift(record);
                userData[currentUser.username].exerciseHistory = exerciseHistory;
                localStorage.setItem('userData', JSON.stringify(userData));
            }
            const todayTime = parseInt(document.getElementById('todayExerciseTime').value) || 0;
            document.getElementById('todayExerciseTime').value = todayTime + duration;
            updateHydrationAdvice(todayTime + duration);
        }

        function recalculateElectrolytes() {
            // 使用保存的数据重新计算
            calculateAndDisplayResults(
                lastCalculation.weight,
                lastCalculation.age,
                lastCalculation.duration,
                lastCalculation.temperature,
                lastCalculation.calories,
                lastCalculation.exerciseType
            );
        }

        function calculateAndDisplayResults(weight, age, duration, temperature, calories, exerciseType) {
            // 计算出汗量
            const sweatRate = 0.015; // L/kg/h
            const tempFactor = 1 + (temperature - 20) * 0.02;
            const sweatVolume = weight * sweatRate * (duration / 60) * tempFactor;
            
            // 获取当前运动类型的系数
            const typeFactor = Object.values(exerciseTypes).find(type => type.name === exerciseType).factor;
            const adjustedSweatVolume = sweatVolume * typeFactor;

            // 计算电解质流失量
            const sodium = adjustedSweatVolume * 1000;
            const potassium = adjustedSweatVolume * 200;
            const magnesium = adjustedSweatVolume * 20;
            const chloride = adjustedSweatVolume * 1500;

            // 计算建议补充量（考虑年龄因素）
            const ageFactor = age < 18 ? 1.2 : age > 50 ? 0.8 : 1.0;
            const recommendedSodium = sodium * ageFactor;
            const recommendedPotassium = potassium * ageFactor;
            const recommendedMagnesium = magnesium * ageFactor;
            const recommendedChloride = chloride * ageFactor;

            // 计算饮料推荐
            const recommendations = calculateDrinkRecommendation(recommendedSodium, recommendedPotassium);
            
            // 显示饮料推荐
            let recommendationHtml = '<div style="display: grid; gap: 1rem;">';
            let drinkDetails = [];
            for (let drink in recommendations) {
                const rec = recommendations[drink];
                recommendationHtml += `
                    <div style="background: #f8fafc; padding: 1rem; border-radius: 8px;">
                        <h5 style="margin-bottom: 0.5rem;">${drink}</h5>
                        <div style="font-size: 0.875rem;">
                            <div>建议补充：${rec.bottles}瓶（${rec.totalVolume}ml）</div>
                            <div style="color: #ef4444;">含糖量：${rec.totalSugar}克</div>
                        </div>
                    </div>
                `;
                drinkDetails.push({
                    name: drink,
                    bottles: rec.bottles,
                    volume: rec.totalVolume,
                    sugar: rec.totalSugar
                });
            }
            recommendationHtml += '</div>';

            // 生成饮料推荐文本
            let recommendedDrinks = '';
            for (let drink in recommendations) {
                const rec = recommendations[drink];
                recommendedDrinks += `${drink}${rec.bottles}瓶 `;
            }

            // 显示结果
            document.getElementById('resultCard').style.display = 'block';
            document.getElementById('sweatVolume').textContent = adjustedSweatVolume.toFixed(2) + ' L';
            document.getElementById('sodium').textContent = Math.round(recommendedSodium) + ' mg';
            document.getElementById('potassium').textContent = Math.round(recommendedPotassium) + ' mg';
            document.getElementById('magnesium').textContent = Math.round(recommendedMagnesium) + ' mg';
            document.getElementById('chloride').textContent = Math.round(recommendedChloride) + ' mg';
            document.getElementById('drinkRecommendation').innerHTML = recommendationHtml;

            return {
                sweatVolume: adjustedSweatVolume.toFixed(2),
                recommendedDrinks: recommendedDrinks.trim(),
                sodium: Math.round(recommendedSodium),
                potassium: Math.round(recommendedPotassium),
                magnesium: Math.round(recommendedMagnesium),
                chloride: Math.round(recommendedChloride),
                drinkDetails: drinkDetails
            };
        }

        function showExerciseHistory() {
            const history = document.getElementById('exerciseHistory');
            const historyList = document.getElementById('historyList');
            
            if (!currentUser) {
                alert('请先登录');
                return;
            }
            
            // 生成历史记录HTML
            let historyHtml = '';
            exerciseHistory.forEach((record, index) => {
                historyHtml += `
                    <div style="background: #f8fafc; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <h4 style="margin: 0;">${record.exerciseType}</h4>
                            <span style="color: #6b7280;">${record.date}</span>
                        </div>
                        <div style="font-size: 0.875rem; color: #4b5563;">
                            <div>基本信息：</div>
                            <div>体重：${record.weight}kg</div>
                            <div>年龄：${record.age}岁</div>
                            <div>运动时长：${record.duration}分钟</div>
                            <div>消耗卡路里：${record.calories}kcal</div>
                            <div>环境温度：${record.temperature}℃</div>
                            <div style="margin-top: 0.5rem;">出汗情况：</div>
                            <div>出汗量：${record.sweatVolume}L</div>
                            <div style="margin-top: 0.5rem;">电解质流失：</div>
                            <div>钠 (Na+)：${record.sodium}mg</div>
                            <div>钾 (K+)：${record.potassium}mg</div>
                            <div>镁 (Mg²⁺)：${record.magnesium}mg</div>
                            <div>氯 (Cl⁻)：${record.chloride}mg</div>
                            <div style="margin-top: 0.5rem;">补充建议：</div>
                            ${record.drinkDetails.map(drink => `
                                <div style="margin-left: 1rem;">
                                    <div>${drink.name}：${drink.bottles}瓶（${drink.volume}ml）</div>
                                    <div style="color: #ef4444;">含糖量：${drink.sugar}克</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            });

            if (historyHtml === '') {
                historyHtml = '<div style="text-align: center; color: #6b7280;">暂无运动记录</div>';
            }

            historyList.innerHTML = historyHtml;
            history.classList.add('active');
        }

        function hideExerciseHistory() {
            const history = document.getElementById('exerciseHistory');
            history.classList.remove('active');
        }

        // 添加输入框变化监听
        document.querySelectorAll('.form-control').forEach(input => {
            input.addEventListener('change', function() {
                if (document.getElementById('resultCard').style.display === 'block') {
                    calculateElectrolytes();
                }
            });
        });

        // 初始化页面
        updateTodayExerciseTime();
        generateAvatarOptions();

        // 添加登出功能
        function logout() {
            currentUser = null;
            document.getElementById('userAvatar').src = 'https://api.dicebear.com/7.x/avataaars/svg?seed=default';
            document.getElementById('userName').textContent = '未登录';
            updateTodayExerciseTime();
        }

        // 修改用户信息区域，添加登出按钮
        document.querySelector('.user-info').innerHTML = `
            <img id="userAvatar" src="https://api.dicebear.com/7.x/avataaars/svg?seed=default" alt="用户头像" class="avatar" onclick="showLoginModal()">
            <span id="userName">未登录</span>
            <button class="login-btn" onclick="showLoginModal()">登录</button>
            <button class="login-btn" onclick="logout()" style="display: none; background: #ef4444;" id="logoutBtn">登出</button>
        `;

        // 新增：禁用/启用运动类型按钮和数据输入框
        function setExerciseUIEnabled(enabled) {
            const btnIds = ['btn-swimming','btn-cycling','btn-running','btn-basketball','btn-football','btn-badminton','btn-tennis'];
            btnIds.forEach(id => {
                const btn = document.getElementById(id);
                if (btn) btn.disabled = !enabled;
            });
            document.querySelectorAll('.record-input').forEach(input => {
                input.disabled = !enabled;
            });
        }

        // 登录和登出时调用
        function updateLoginStatus() {
            const logoutBtn = document.getElementById('logoutBtn');
            if (currentUser) {
                document.querySelector('.login-btn').style.display = 'none';
                logoutBtn.style.display = 'block';
                setExerciseUIEnabled(true);
            } else {
                document.querySelector('.login-btn').style.display = 'block';
                logoutBtn.style.display = 'none';
                setExerciseUIEnabled(false);
            }
        }

        // 页面初始化时禁用
        setExerciseUIEnabled(false);

        // 热身与拉伸动作数据
        const warmupData = {
            swimming: [
                {
                    name: '手臂环绕',
                    img: 'https://oaidalleapiprodscus.blob.core.windows.net/private/org-xxx/dalle-ai-swim-arm-circle.png',
                    desc: '双手伸直，从前向后绕大圈10次，再从后向前10次，活动肩关节。'
                },
                {
                    name: '肩部放松转动',
                    img: 'https://oaidalleapiprodscus.blob.core.windows.net/private/org-xxx/dalle-ai-shoulder-relax.png',
                    desc: '耸肩，然后放松，同时肩膀画圈各10次。'
                },
                {
                    name: '肩部拉伸',
                    img: 'https://oaidalleapiprodscus.blob.core.windows.net/private/org-xxx/dalle-ai-shoulder-stretch.png',
                    desc: '一只手臂伸直横过胸前，另一只手拉住手臂肘部，保持20秒，换手。'
                },
                {
                    name: '背部拉伸（猫式伸展）',
                    img: 'https://oaidalleapiprodscus.blob.core.windows.net/private/org-xxx/dalle-ai-cat-stretch.png',
                    desc: '四肢着地，拱背吸气，然后塌腰抬头呼气，各持续5秒，做5组。'
                }
            ],
            football: [
                {
                    name: '高抬腿',
                    img: 'https://oaidalleapiprodscus.blob.core.windows.net/private/org-xxx/dalle-ai-high-knee.png',
                    desc: '原地高抬腿30秒。'
                },
                {
                    name: '弓步走',
                    img: 'https://oaidalleapiprodscus.blob.core.windows.net/private/org-xxx/dalle-ai-lunge-walk.png',
                    desc: '每一步下压到膝盖90度，前后腿交换走10步。'
                },
                {
                    name: '股四头肌拉伸',
                    img: 'https://oaidalleapiprodscus.blob.core.windows.net/private/org-xxx/dalle-ai-quad-stretch.png',
                    desc: '站立，一只手拉住同侧脚踝贴近臀部，保持20秒，换边。'
                },
                {
                    name: '小腿拉伸（靠墙蹬伸）',
                    img: 'https://oaidalleapiprodscus.blob.core.windows.net/private/org-xxx/dalle-ai-calf-wall-stretch.png',
                    desc: '一脚前一脚后，后脚脚跟贴地，前脚屈膝靠墙，保持20秒。'
                }
            ],
            basketball: [
                {
                    name: '跳跃开合跳',
                    img: 'https://oaidalleapiprodscus.blob.core.windows.net/private/org-xxx/dalle-ai-jumping-jack.png',
                    desc: '快速热身全身肌肉，持续30秒。'
                },
                {
                    name: '手腕脚踝绕环',
                    img: 'https://oaidalleapiprodscus.blob.core.windows.net/private/org-xxx/dalle-ai-wrist-ankle-circle.png',
                    desc: '每个关节绕环10圈。'
                },
                {
                    name: '腘绳肌拉伸（站姿压腿）',
                    img: 'https://oaidalleapiprodscus.blob.core.windows.net/private/org-xxx/dalle-ai-hamstring-stretch.png',
                    desc: '一脚抬至高处（如椅子），身体前倾保持20秒，换腿。'
                },
                {
                    name: '肩膀交叉拉伸',
                    img: 'https://oaidalleapiprodscus.blob.core.windows.net/private/org-xxx/dalle-ai-shoulder-cross-stretch.png',
                    desc: '同游泳动作，肩膀放松拉伸。'
                }
            ],
            badminton: [
                {
                    name: '手腕绕环',
                    img: 'https://oaidalleapiprodscus.blob.core.windows.net/private/org-xxx/dalle-ai-wrist-circle.png',
                    desc: '双手手腕顺时针/逆时针各10圈。'
                },
                {
                    name: '侧身拉伸',
                    img: 'https://oaidalleapiprodscus.blob.core.windows.net/private/org-xxx/dalle-ai-side-stretch.png',
                    desc: '手举过头，向左右两边拉伸侧腰各10秒。'
                },
                {
                    name: '前臂伸展',
                    img: 'https://oaidalleapiprodscus.blob.core.windows.net/private/org-xxx/dalle-ai-forearm-stretch.png',
                    desc: '一只手伸直，手掌朝下，另一只手轻轻将手指向下压，保持20秒。'
                },
                {
                    name: '肩膀后拉',
                    img: 'https://oaidalleapiprodscus.blob.core.windows.net/private/org-xxx/dalle-ai-shoulder-back-stretch.png',
                    desc: '双手于背后十指交叉向下拉，打开胸部20秒。'
                }
            ],
            cycling: [
                {
                    name: '髋部开合',
                    img: 'https://oaidalleapiprodscus.blob.core.windows.net/private/org-xxx/dalle-ai-hip-open.png',
                    desc: '双腿抬高做开合动作（站姿），各20次。'
                },
                {
                    name: '小腿垫脚跳',
                    img: 'https://oaidalleapiprodscus.blob.core.windows.net/private/org-xxx/dalle-ai-calf-jump.png',
                    desc: '轻跳提高小腿弹性，30秒。'
                },
                {
                    name: '髂腰肌拉伸',
                    img: 'https://oaidalleapiprodscus.blob.core.windows.net/private/org-xxx/dalle-ai-iliopsoas-stretch.png',
                    desc: '弓步姿势，后腿膝盖贴地，前腿90度，髋部前压，保持20秒。'
                },
                {
                    name: '腰背部扭转拉伸',
                    img: 'https://oaidalleapiprodscus.blob.core.windows.net/private/org-xxx/dalle-ai-back-twist.png',
                    desc: '坐姿扭腰，一条腿搭在另一条腿外侧，手肘顶膝旋转上半身。'
                }
            ],
            tennis: [
                {
                    name: '肩膀转圈+手腕绕环',
                    img: 'https://oaidalleapiprodscus.blob.core.windows.net/private/org-xxx/dalle-ai-shoulder-wrist-circle.png',
                    desc: '各方向10次。'
                },
                {
                    name: '左右弓步压腿',
                    img: 'https://oaidalleapiprodscus.blob.core.windows.net/private/org-xxx/dalle-ai-side-lunge.png',
                    desc: '像相扑式压腿，每边10次。'
                },
                {
                    name: '前臂伸展',
                    img: 'https://oaidalleapiprodscus.blob.core.windows.net/private/org-xxx/dalle-ai-forearm-stretch.png',
                    desc: '与羽毛球类似，手掌向下压。'
                },
                {
                    name: '斜方肌拉伸',
                    img: 'https://oaidalleapiprodscus.blob.core.windows.net/private/org-xxx/dalle-ai-trapezius-stretch.png',
                    desc: '坐姿或站姿，一只手扶头侧拉向肩膀方向，保持20秒，换边。'
                }
            ]
        };

        // 新增：显示热身与拉伸弹窗
        function showWarmupModal(type) {
            if (!currentUser) {
                requireLoginAlert();
                return;
            }
            const data = warmupData[type] || [];
            let html = '';
            data.forEach(item => {
                html += `<div style='margin-bottom:1.5rem;'>
                    <img src='${item.img}' alt='${item.name}' style='width:120px;height:120px;object-fit:contain;display:block;margin-bottom:0.5rem;'>
                    <div style='font-weight:bold;'>${item.name}</div>
                    <div style='color:#4b5563;font-size:0.95rem;'>${item.desc}</div>
                </div>`;
            });
            document.getElementById('warmupTitle').textContent = exerciseTypes[type].name + ' 热身与拉伸';
            document.getElementById('warmupContent').innerHTML = html || '<div style="color:#6b7280;">暂无推荐动作</div>';
            document.getElementById('warmupModal').classList.add('active');
        }
        function hideWarmupModal() {
            document.getElementById('warmupModal').classList.remove('active');
        }

        // 在运动类型按钮下方添加"热身与拉伸"按钮
        btnIds.forEach(id => {
            const btn = document.getElementById(id);
            if (btn) {
                // 创建热身按钮
                const warmBtn = document.createElement('button');
                warmBtn.textContent = '热身与拉伸';
                warmBtn.className = 'exercise-btn';
                warmBtn.style.background = '#fef9c3';
                warmBtn.style.marginTop = '8px';
                warmBtn.onclick = function(e) {
                    e.stopPropagation();
                    showWarmupModal(id.replace('btn-',''));
                };
                btn.parentNode.insertBefore(warmBtn, btn.nextSibling);
            }
        });
    </script>
</body>
</html> 